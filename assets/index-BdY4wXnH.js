(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();let c=[];const h="HABIT_KEY";let l;const i={menu:document.querySelector(".menu__list"),header:{h1:document.querySelector(".h1"),progressPercent:document.querySelector(".progress__percent"),progressCoverBar:document.querySelector(".progress__coverBar")},content:{daysContainer:document.getElementById("days"),nextDay:document.querySelector(".habit__day"),form:document.querySelector(".habit__form"),habitListContainer:document.getElementById("habit-list")},popup:{index:document.getElementById("add-habit-popup"),iconField:document.querySelector(".popup__form input[name='icon']"),addHabitForm:document.querySelector(".popup__form")}};function b(){const t=localStorage.getItem(h),e=JSON.parse(t);c=Array.isArray(e)?e:[]}function p(){localStorage.setItem(h,JSON.stringify(c))}function f(){i.popup.index.classList.contains("cover_hidden")?i.popup.index.classList.remove("cover_hidden"):i.popup.index.classList.add("cover_hidden")}function g(t,e){for(const o of e)t[o].value="",t[o].classList.remove("error")}function _(t,e){const o=new FormData(t),a={};let r=!0;for(const n of e){const d=o.get(n);t[n].classList.remove("error"),d||(t[n].classList.add("error"),r=!1),a[n]=d}if(r)return a}function y(t){i.menu.innerHTML="";for(const e of c){const o=document.createElement("button");o.setAttribute("menu-habit-id",e.id),o.classList.add("menu__item"),o.innerHTML=` <img src="./src/assets/${e.icon}.svg" alt="${e.name}" >`,t.id===e.id&&o.classList.add("menu__item--active"),o.addEventListener("click",()=>u(e.id)),i.menu.prepend(o)}}function E(t){i.header.h1.innerText=t.name;const e=t.days.length/t.target>1?100:t.days.length/t.target*100;i.header.progressPercent.innerText=e.toFixed(0)+"%",i.header.progressCoverBar.style.width=`${e}%`;const o=document.querySelector(".habit__delete");o&&o.addEventListener("click",()=>v(t.id))}function C(t){c=c.map(e=>e.id===l?(e.days.splice(t,1),{...e,days:e.days}):e),p(),u(l)}function L(t){i.content.daysContainer.innerHTML="",t.days.forEach((e,o)=>{const a=document.createElement("div");a.classList.add("habit");const r=document.createElement("div");r.classList.add("habit__day"),r.textContent=`Day ${o+1}`;const n=document.createElement("div");n.classList.add("habit__comment-container");const d=document.createElement("div");if(d.classList.add("habit__comment-text"),d.textContent=e.comment,n.appendChild(d),e.comment){const s=document.createElement("button");s.classList.add("day__delete"),s.addEventListener("click",()=>C(o));const m=document.createElement("img");m.src="./src/assets/delete.svg",m.alt=`Delete day ${o+1}`,s.appendChild(m),n.appendChild(s)}a.appendChild(r),a.appendChild(n),i.content.daysContainer.appendChild(a)}),i.content.nextDay.innerHTML=`Day ${t.days.length+1}`}function u(t){l=t;const e=c.find(o=>o.id===t);e&&(document.location.replace(document.location.pathname+"#"+t),y(e),E(e),L(e))}function S(t){t.preventDefault();const e=_(t.target,["comment"]);e&&(c=c.map(o=>o.id===l?{...o,days:o.days.concat([{comment:e.comment}])}:o),p(),u(l),g(t.target,["comment"]))}function B(t){t.preventDefault(),console.log("addHabit function called");const e=_(t.target,["name","icon","target"]);if(!e){console.log("Form validation failed");return}const a={id:c.reduce((r,n)=>r>n.id?r:n.id,0)+1,name:e.name,target:e.target,icon:e.icon,days:[]};c.push(a),p(),u(a.id),g(t.target,["name","target"]),f()}i.header.h1.addEventListener("click",()=>{});function D(t,e){i.popup.iconField.value=e,document.querySelector(".icon.icon_active").classList.remove("icon_active"),t.classList.add("icon_active")}function v(t){c=c.filter(e=>e.id!==t),p(),l===t?(l=null,document.location.hash="",i.header.h1.innerText="-",i.header.progressPercent.innerText="0%",i.header.progressCoverBar.style.width="0%",i.content.daysContainer.innerHTML="",c.length>0?u(c[0].id):(y({}),i.content.nextDay.innerText="")):y(c.find(e=>e.id===l)||{}),L(c.find(e=>e.id===l)||{})}(()=>{b();function t(){var n;if(c.length>0){const d=Number(document.location.hash.replace("#","")),s=c.find(m=>m.id===d);u(s?s.id:(n=c[0])==null?void 0:n.id)}}t(),i.content.form.addEventListener("submit",S),i.popup.addHabitForm.addEventListener("submit",B),document.querySelector(".menu__add").addEventListener("click",f),document.querySelectorAll(".icon").forEach(n=>{n.addEventListener("click",function(){const d=this.querySelector("img").getAttribute("alt").toLowerCase();D(this,d)})}),document.querySelector(".popup__close").addEventListener("click",f),document.getElementById("days").addEventListener("click",function(n){if(n.target.closest(".habit__delete")){const d=n.target.closest(".habit");if(d){const s=Number(d.dataset.habitId);v(s)}}})})();
